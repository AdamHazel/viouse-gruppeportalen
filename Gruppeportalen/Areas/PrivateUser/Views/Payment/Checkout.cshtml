@model Gruppeportalen.Areas.PrivateUser.Models.ViewModels.PaymentViewModel

@{
    ViewBag.Title = "title";
    Layout = "_Layout";
}

<h2>Betaling</h2>

<div>
    <p><strong>Medlemskap:</strong> @Model.MembershipName</p>
    <p><strong>Pris:</strong> @Model.Price kr</p>

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-danger">@Model.ErrorMessage</div>
    }
</div>

<form method="post" asp-action="ProcessPayment">
    <input type="hidden" name="MembershipTypeId" value="@Model.MembershipTypeId" />
    <input type="hidden" id="nonce" name="Nonce" />

    <div id="dropin-container"></div>
    <button type="submit" class="btn btn-primary">Betal nå</button>
</form>

<script src="https://js.braintreegateway.com/web/dropin/1.33.0/js/dropin.min.js"></script>
<script>
    var clientToken = '@ViewBag.ClientToken';

    braintree.dropin.create({
        authorization: clientToken,
        container: '#dropin-container'
    }, function (err, instance) {
        document.querySelector('form').addEventListener('submit', function (event) {
            event.preventDefault();

            instance.requestPaymentMethod(function (err, payload) {
                if (!err) {
                    document.querySelector('#nonce').value = payload.nonce;
                    event.target.submit();
                }
            });
        });
    });
</script>
